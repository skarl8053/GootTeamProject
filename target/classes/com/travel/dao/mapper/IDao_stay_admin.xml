<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<!-- (namespace) 인터페이스 경로 -->
<mapper namespace="com.travel.dao.admin.IDao_stay_admin">
	<!-- 신재환 / 관리자 -> 숙소등록 -->
	
	<!-- 숙소 공통 정보 등록 -->
	<insert id="stayInsert" parameterType="java.util.List">
		    INSERT INTO TMSTSTAY (
		        S_NO, S_NAME, S_TYPE, S_INFO, S_LOCA,
		        S_ADDR_X,S_ADDR_Y,
		        S_IMG1,S_IMG2,S_IMG3,S_ADDR,
		        S_FACILITY1, S_FACILITY2, S_FACILITY3, S_FACILITY4, S_FACILITY5, S_FACILITY6,
		        S_THEME1, S_THEME2, S_THEME3, S_THEME4, S_THEME5, S_THEME6, S_THEME7, S_THEME8
		    ) VALUES ( (SELECT NVL(MAX(S_NO),0) +1 FROM TMSTSTAY),
		    <foreach collection="list" separator="," item="StayData" close=")">
		            #{StayData}
		    </foreach>
	</insert>	

	<!-- 숙소 객실 정보 등록 -->	
			<insert id="stayRoomInsert" parameterType="com.travel.dto.admin.DTO_Stay_room_admin">
			     <selectKey keyProperty="s_no" resultType="java.lang.Integer" order="BEFORE">
			        SELECT S_NO FROM TMSTSTAY WHERE S_NAME = #{stay_title}
			    </selectKey>
			    
			    INSERT INTO TMSTROOM (
			        R_NO,S_NO,R_NAME,R_DETAIL,R_PERSON_CNT,R_PRICE,
			        R_IMG1,R_IMG2,R_IMG3,
			        R_SINGLE_BED_FLAG,R_DOUBLE_BED_FLAG,R_QUEEN_BED_FLAG,
			        R_FACILITY1,R_FACILITY2,R_FACILITY3,R_FACILITY4,R_FACILITY5,R_FACILITY6
			    ) VALUES (
			        (SELECT NVL(MAX(R_NO),0) + 1 FROM TMSTROOM),
			        #{s_no},
			        <foreach collection="stayRoomData" separator="," item="data">
			            #{data}
			        </foreach>
			    )
			   
			</insert>

	<!-- 숙소 리스트 불러오기 -->
		<!-- <select  id="stay_list" resultType="com.travel.dto.admin.DTO_Stay_admin">
			SELECT S_NO,S_NAME FROM TMSTSTAY ORDER BY S_NO DESC
		</select> -->
		
	<!-- 숙소 삭제하기 -->
		<delete id="stay_delete">
			DELETE FROM TMSTSTAY WHERE S_NO=#{param1}
		</delete>		
		
	<!-- 숙소 디테일 뷰 -->
		<select id="stay_view" resultType="com.travel.dto.admin.DTO_Stay_admin">
			SELECT S_NO, S_NAME, S_TYPE, S_INFO, S_LOCA, 
		        S_FACILITY1, S_FACILITY2, S_FACILITY3, S_FACILITY4, S_FACILITY5, S_FACILITY6,
		        S_THEME1, S_THEME2, S_THEME3, S_THEME4, S_THEME5, S_THEME6, S_THEME7, S_THEME8
		   	FROM TMSTSTAY 
		   	WHERE S_NO=#{param1}
		</select>
		
	<!-- 숙소 객실 디테일 뷰 -->
		<!-- <select id="stay_room_view" resultType="com.travel.dto.admin.DTO_Stay_room_admin">
			select r_name, r_detail, r_person_cnt, r_price, 
			r_single_bed_flag, r_double_bed_flag, r_queen_bed_flag,
			r_facility1, r_facility2, r_facility3, r_facility4, r_facility5, r_facility6
			from tmstroom
			where s_no
		</select> -->
		
		<select id="selectBoardTotCount" resultType="java.lang.Integer">
			SELECT COUNT(*) FROM TMSTSTAY
		</select>
		
		<!-- 기존 list 불러오던 sql
		 <select id="list" resultType="com.travel.dto.admin.DTO_Stay_admin">
			SELECT *
			FROM (
			    SELECT ROWNUM AS NUM, N.*
			    FROM (
			        SELECT *
			        FROM TMSTSTAY
			        ORDER BY S_NO DESC
			    ) N
			)
			WHERE NUM BETWEEN #{param1} AND #{param2}
		</select> -->
		
		<sql id="search_list">
		<if test="param4 == 0">
			<if test="param3 == 0">
				
			</if>
			<if test="param3 != 0">
				WHERE S_LOCA = #{param3}
			</if>
		</if>
		
	
		<if test="param4 == 1">
			<if test="param3 == 0">
				WHERE S_TYPE = #{param4}
			</if>
			<if test="param3 != 0">
				WHERE S_LOCA = #{param3}
				AND S_TYPE = #{param4}
			</if>
		</if>
		
	
		<if test="param4 == 2">
			<if test="param3 == 0">
				WHERE S_TYPE = #{param4}
			</if>
			<if test="param3 != 0">
				WHERE S_LOCA = #{param3}
				AND S_TYPE = #{param4}
			</if>
		</if>
		
	
		<if test="param4 == 3">
			<if test="param3 == 0">
				WHERE S_TYPE = #{param4}
			</if>
			<if test="param3 != 0">
				WHERE S_LOCA = #{param3}
				AND S_TYPE = #{param4}
			</if>
		</if>
	</sql>
	
		<select id="list" resultType="com.travel.dto.admin.DTO_Stay_admin">
		    SELECT *
			FROM (
			    SELECT ROWNUM NUM, N.*
			    FROM (
			        SELECT *
			        FROM TMSTSTAY
			        ORDER BY S_NO DESC
			    ) N
			    <include refid="search_list"/>
			)
			WHERE NUM BETWEEN #{param1} AND #{param2}
					    
		</select>
		
		<update id="modify" parameterType="java.util.List">
			UPDATE TMSTSTAY
		   	SET 
		   	<foreach collection="list" separator="," item="StayData">
		            #{StayData}
		    </foreach>
		   	WHERE S_NO=#{param2}	
		</update>
		
	</mapper>