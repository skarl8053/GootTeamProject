<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- (namespace) 인터페이스 경로 -->
<mapper namespace="com.travel.dao.user.IDao_Member_user">

	<!-- 회원가입 -->
	<insert id="member_join" parameterType="com.travel.dto.user.DTO_Member_user">
		INSERT INTO TMSTMEMBER VALUES(
		TMSTMEMBER_M_NO_SEQ.NEXTVAL,
		#{param1},#{param2},#{param3},#{param4},2,0,#{param5},#{param6},#{param7},#{param8},
		#{param9},#{param10},#{param11},#{param12},'Y')
	</insert>
	
	<!-- m_no 조회 -->
	<select id="search_no" resultType="String">
		SELECT M_NO FROM TMSTMEMBER WHERE M_EMAIL=#{param1}
	</select>
	
	<!-- 회원가입 쿠폰 지급 -->
	<insert id="member_join_coupon" parameterType="com.travel.dto.user.DTO_Member_user">
		INSERT INTO THISCOUPON VALUES(#{param1},10000,1)
	</insert>
	
	<!-- 이메일 중복 체크 및 인증 이메일 전송 -->
	<select id="member_check" parameterType="java.lang.String" resultType="com.travel.dto.user.DTO_Member_user">
		SELECT M_EMAIL FROM TMSTMEMBER WHERE M_EMAIL=#{param1} AND M_LOCK = 'Y'
	</select>

	<!-- 전송 이메일 확인 후 업데이트 -->
	<update id="update_m_lock" parameterType="java.lang.String">
		UPDATE TMSTMEMBER SET M_LOCK = 'N' WHERE M_EMAIL = #{param1}
	</update>
	
	<!-- m_lock 조회 -->
	<select id="search_lock" resultType="String">
		SELECT M_LOCK FROM TMSTMEMBER WHERE M_EMAIL=#{param1}
	</select>
	
	<!-- 로그인 -->
	<select id="member_login" parameterType="java.lang.String" resultType="com.travel.dto.user.DTO_Member_user">
		SELECT M_EMAIL, M_PW, M_SEC FROM TMSTMEMBER WHERE M_EMAIL=#{param1} AND M_PW=#{param2} AND M_LOCK='N' 
	</select>
	
	<!-- 회원 탈퇴 -->
	<update id="member_delete">
		UPDATE TMSTMEMBER SET M_LOCK='Y' WHERE (SELECT M_PW FROM TMSTMEMBER WHERE M_EMAIL=#{param1}) = #{param2}
	</update>
	
	<!-- 회원정보 수정 -->
	<update id="member_modify">
		UPDATE TMSTMEMBER SET
		M_PW=#{param2},M_TEL=#{param3},M_ADDRESS=#{param4},M_MARKETING=#{param5},M_AREA1=#{param6},,M_AREA2=#{param7},M_AREA3=#{param8},
		M_THEME1=#{param9},M_THEME2=#{param10},M_THEME3=#{param11}
		WHERE
		M_EMAIL=#{param1}
	</update>


</mapper>