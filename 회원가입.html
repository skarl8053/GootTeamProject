<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
</head>
<body>

	<script>

		
		// 주소 찾기

		//본 예제에서는 도로명 주소 표기 방식에 대한 법령에 따라, 내려오는 데이터를 조합하여 올바른 주소를 구성하는 방법을 설명합니다.
		function sample4_execDaumPostcode() {
		new daum.Postcode({
			oncomplete: function (data) {
			// 팝업에서 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.

			// 도로명 주소의 노출 규칙에 따라 주소를 표시한다.
			// 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
			var roadAddr = data.roadAddress; // 도로명 주소 변수
			var extraRoadAddr = ""; // 참고 항목 변수

			// 법정동명이 있을 경우 추가한다. (법정리는 제외)
			// 법정동의 경우 마지막 문자가 "동/로/가"로 끝난다.
			if (data.bname !== "" && /[동|로|가]$/g.test(data.bname)) {
				extraRoadAddr += data.bname;
			}
			// 건물명이 있고, 공동주택일 경우 추가한다.
			if (data.buildingName !== "" && data.apartment === "Y") {
				extraRoadAddr +=
				extraRoadAddr !== "" ? ", " + data.buildingName : data.buildingName;
			}
			// 표시할 참고항목이 있을 경우, 괄호까지 추가한 최종 문자열을 만든다.
			if (extraRoadAddr !== "") {
				extraRoadAddr = " (" + extraRoadAddr + ")";
			}

			// 우편번호와 주소 정보를 해당 필드에 넣는다.
			document.getElementById("sample4_postcode").value = data.zonecode;
			document.getElementById("sample4_roadAddress").value = roadAddr;
			document.getElementById("sample4_jibunAddress").value = data.jibunAddress;

			// 참고항목 문자열이 있을 경우 해당 필드에 넣는다.
			if (roadAddr !== "") {
				document.getElementById("sample4_extraAddress").value = extraRoadAddr;
			} else {
				document.getElementById("sample4_extraAddress").value = "";
			}

			var guideTextBox = document.getElementById("guide");
			// 사용자가 '선택 안함'을 클릭한 경우, 예상 주소라는 표시를 해준다.
			if (data.autoRoadAddress) {
				var expRoadAddr = data.autoRoadAddress + extraRoadAddr;
				guideTextBox.innerHTML = "(예상 도로명 주소 : " + expRoadAddr + ")";
				guideTextBox.style.display = "block";
			} else if (data.autoJibunAddress) {
				var expJibunAddr = data.autoJibunAddress;
				guideTextBox.innerHTML = "(예상 지번 주소 : " + expJibunAddr + ")";
				guideTextBox.style.display = "block";
			} else {
				guideTextBox.innerHTML = "";
				guideTextBox.style.display = "none";
			}
			},
		}).open();
		}


		// 약관 모두 체크, 해제


		const checkAll = document.querySelector('.terms__check__all input');
		const checkBoxes = document.querySelectorAll('.input__check input');
		const submitButton = document.querySelector('.join_button');

		const agreements = {
		termsOfService: false,
		privacyPolicy: false,
		allowPromotions: false,
		};


		checkBoxes.forEach((item) => item.addEventListener('input', toggleCheckbox));

		function toggleCheckbox(e) {
		const { checked, id } = e.target;  
		agreements[id] = checked;
		this.parentNode.classList.toggle('active');
		checkAllStatus();
		toggleSubmitButton();
		}

		function checkAllStatus() {
		const { termsOfService, privacyPolicy, allowPromotions } = agreements;
		if (termsOfService && privacyPolicy && allowPromotions) {
			checkAll.checked = true;
		} else {
			checkAll.checked = false;
		}
		}

		function toggleSubmitButton() {
		const { termsOfService, privacyPolicy } = agreements;
		if (termsOfService && privacyPolicy) {
			submitButton.disabled = false;
		} else {
			submitButton.disabled = true;
		}
		}

		checkAll.addEventListener('click', (e) => {
		const { checked } = e.target;
		if (checked) {
			checkBoxes.forEach((item) => {
			item.checked = true;
			agreements[item.id] = true;
			item.parentNode.classList.add('active');
			});
		} else {
			checkBoxes.forEach((item) => {
			item.checked = false;
			agreements[item.id] = false;
			item.parentNode.classList.remove('active');
			});
		}
		toggleSubmitButton();
		});

		// 약관 보기 모달 창

		const modal1 = document.getElementById("modal1");
		const btnModal1 = document.getElementById("btn-modal1");

		btnModal1.addEventListener("click", (e) => {
		modal1.style.display = "flex";
		});
		const closeBtn1 = modal1.querySelector(".close-area");
		closeBtn1.addEventListener("click", (e) => {
		modal1.style.display = "none";
		});
		const closeBtn2 = modal1.querySelector(".last_check");
		closeBtn2.addEventListener("click", (e) => {
		modal1.style.display = "none";
		});
		modal1.addEventListener("click", (e) => {
		const evTarget = e.target;
		if (evTarget.classList.contains("modal-overlay")) {
			modal1.style.display = "none";
		}
		});
		window.addEventListener("keyup", (e) => {
		if (modal1.style.display === "flex" && e.key === "Escape") {
			modal1.style.display = "none";
		}
		});


		const modal2 = document.getElementById("modal2");
		const btnModal2 = document.getElementById("btn-modal2");

		btnModal2.addEventListener("click", (e) => {
		modal2.style.display = "flex";
		});
		const closeBtn3 = modal2.querySelector(".close-area");
		closeBtn3.addEventListener("click", (e) => {
		modal2.style.display = "none";
		});
		const closeBtn4 = modal2.querySelector(".last_check");
		closeBtn4.addEventListener("click", (e) => {
		modal2.style.display = "none";
		});
		modal2.addEventListener("click", (e) => {
		const evTarget = e.target;
		if (evTarget.classList.contains("modal-overlay")) {
			modal2.style.display = "none";
		}
		});
		window.addEventListener("keyup", (e) => {
		if (modal2.style.display === "flex" && e.key === "Escape") {
			modal2.style.display = "none";
		}
		});

		// 이메일 중복확인 및 정규식

		function checking(){
			
			var m_email = $('input#m_email').val();
			var reg = /^[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*\.[a-zA-Z]{2,3}$/i;
			
			
			$.ajax({
				url : "checking",
				method : "GET",
				data : "m_email="+m_email,
				success : function(data){
					if(data=="1"){
						$("#check_text").text("이메일을 입력해주세요.")
						$("#check_text").css("color","red");

						isEmailChecked = false;		
					}else if(data=="0"){		
						if((reg.test(m_email))==false){
							$("#check_text").text("이메일 형식에 맞지 않습니다.")
							$("#check_text").css("color","red");

							isEmailChecked = false;					
						}else{
							$("#check_text").text("사용 가능한 이메일입니다.")
							$("#check_text").css("color","green");

							isEmailChecked = true;				
						}
					}else{			
						$("#check_text").text("중복된 이메일입니다.")
						$("#check_text").css("color","red");

						isEmailChecked = false;
					}
				}
			});
		};

		// 비밀번호 정규식

		let timeout;
		let password = document.getElementById('m_pw')
		let strengthBadge = document.getElementById('StrengthDisp')
		let strongPassword = new RegExp('(?=.*[^a-z0-9])(?=.{8,})')
		function StrengthChecker(PasswordParameter) {
			if (strongPassword.test(PasswordParameter)) {
				strengthBadge.style.color = "green"
				strengthBadge.textContent = '올바른 형식입니다.'
				isPasswordChecked = true;
			} else{
				strengthBadge.style.color = "red"
				strengthBadge.textContent = '영문 소문자, 숫자, 특수문자 1개 이상 포함 8자 이상 '
				isPasswordChecked = false;
			}
		}

		password.addEventListener("input", () => {
		strengthBadge.style.display = 'block'

		clearTimeout(timeout);

		timeout = setTimeout(() => StrengthChecker(password.value), 100);

		if (password.value.length >= 0) {
			strengthBadge.style.display != 'block'
		} else {
			strengthBadge.style.display = 'none'
		}
		});

		function inputNumberOnly(el) {
			el.value = el.value.replace(/[^0-9]/g, '');
		}

		// 테마 및 지역 선택 (남기문 전체적으로 수정 완료)

		var themeArr = null;
		var locationArr = null;

		$(document).ready(
				function() {
					
					// 테마
					$('.btn1').each(function(index) {
						$(this).attr('btn1-index', index);
					}).click(
							function() {
								var index = $(this).attr('btn1-index');
								$('.btn1[btn1-index=' + index + ']').toggleClass('clicked_btn1');
								
								// 남기문 수정 (기존 소스 삭제)
								if(themeArr == null){
									themeArr = new Array();
								}

								// 해당 테마 버튼의 value값 (숫자 가져옴)
								var selectedButtonValue = $('.btn1[btn1-index=' + index + ']').attr('value');
								
								var themeArrIndex = themeArr.findIndex((e) => e == selectedButtonValue);

								if(themeArrIndex == -1){
									if(themeArr.length < 3){
										themeArr.push(selectedButtonValue);
									}
									else{
										alert('테마는 각각 최대 3개까지만 선택이 가능합니다.');
										$('.btn1[btn1-index=' + index + ']').toggleClass('clicked_btn1');
									}
								}
								else{
										themeArr.splice(themeArrIndex, 1);
								}
								
								console.log("themeArr : " + themeArr);
							});
					
					$('.btn2').each(function(index) {
						$(this).attr('btn2-index', index);
					}).click(
							function() {
								var index = $(this).attr('btn2-index');
								$('.btn2[btn2-index=' + index + ']').toggleClass('clicked_btn2');
								
								// 남기문 수정 (기존 소스 삭제)
								if(locationArr == null){
									locationArr = new Array();
								}
								
								// 해당 지역 버튼의 value값 (숫자 가져옴)
								var selectedButtonValue = $('.btn2[btn2-index=' + index + ']').attr('value');
								
								// 해당 value가 배열에 있는지 확인 / 없으면 -1 반환, 있으면 N번째 수 반환
								var locationArrIndex = locationArr.findIndex((e) => e == selectedButtonValue);
								
								if(locationArrIndex == -1){
									if(locationArr.length < 3){
										// 배열에 값이 없고, 배열 내의 개수가 3개 이하인 경우 insert
										locationArr.push(selectedButtonValue);
									}
									else{
										alert('선호 지역은 각각 최대 3개까지만 선택이 가능합니다.');
										$('.btn2[btn2-index=' + index + ']').toggleClass('clicked_btn2');
									}
								}
								else{
									// N번째 인덱스를 이용하여 데이터 삭제
									locationArr.splice(locationArrIndex, 1);
								}
								console.log("locationArr : " + locationArr);
							});
				});
		////////////////////// 테마 / 선호 지역 선택 : 남기문 /////////////////////////

		var isEmailChecked = false;
		var isPasswordChecked = false;

		function insertBeforeCheck() {

			var tel = new RegExp('010(?=.*[0-9]{8})')

			var p1 = document.getElementById('m_pw').value;
			var p2 = document.getElementById('m_pw2').value;

			var phone_number = $("input[id=m_tel]").val();
			var address = $("input[id=sample4_roadAddress]").val();
			var detail_address = $("input[id=sample4_detailAddress]").val();

			if($("input[id=m_email]").val().length < 1){
				alert("이메일을 입력해주세요");
				return false;
			}

			if(isEmailChecked == false)
			{
				alert("이메일 입력 후 중복확인 버튼을 클릭해주세요");
				return false;
			}
				
			if(isPasswordChecked == false){
				alert("비밀번호를 입력해주세요");
				return false;
			}

			if( p1 != p2 ) {
				alert("비밀번호가 일치하지 않습니다.");
				return false;
			}

			if(phone_number.length < 1){
				alert("휴대폰 정보를 입력해주세요");
				return false;
			}

			if(!tel.test($("input[id=m_tel]").val())){
				alert("휴대폰 번호를 다시 입력해주세요.");
				return false;
			} 

			if(address.length < 1){
				alert("도로명 주소를 입력해주세요");
				return false;
			}
				
			if(detail_address.length < 1){
				alert("상세 주소를 입력해주세요");
				return false;
			}	
			
			if(themeArr.length < 0){
				alert("테마를 최소 1개 이상 선택해주세요");
				return false;
			}

			if(locationArr.length == 0){
				alert("선호지역을 최소 1개 이상 선택해주세요");
				return false;
			}

			// 위에서 저장한 내용을 hidden값에 집어넣어줌..
			document.getElementById("all_tema").value = themeArr;
			document.getElementById("all_area").value = locationArr;
		}

		




	</script>

	<p class="join">회원가입</p>
	<hr>
	<br>
	<form action="joining" onsubmit="return insertBeforeCheck();">
	<input type="hidden" name="all_tema" id="all_tema" value=""/>
	<input type="hidden" name="all_area" id="all_area" value=""/>

		<div class="join-wrapper">
			<table class="member">
				<tr>
					<td><label>이메일</label></td>
					<td><input type="email" class="enter" name="m_email" id="m_email" 
						placeholder="이메일을 입력해주세요."  required autocomplete="off"/>
					</td>
					<td><input type="button" class="certi" id="check_email" onclick="checking()" value="중복확인"></td>	
				</tr>
				<tr>
				<td><label style="display:none;"></label></td>
				<td>
				<span id="check_text" class="check_text"></span>
				</td>
				</tr>
				<tr>
					<td><label>비밀번호</label></td>
					<td><input type="password" class="enter" name="m_pw" id="m_pw"
						placeholder="비밀번호를 입력해주세요." required /> </td>
				</tr>
				<tr>
					<td><label style="display:none;"></label></td>
					<td><span id="StrengthDisp"></span></td>
				</tr>
				<tr>
					<td><label>비밀번호확인</label></td>
					<td><input type="password" class="enter" name="m_pw2" 
						id="m_pw2" placeholder="비밀번호를 한번 더 입력해주세요." required /></td>
				</tr>
				<tr>
					<td><label>이름</label></td>
					<td><input type="text" class="enter" name="m_name" 
						placeholder="이름을 입력해주세요." required autocomplete="off"/></td>
				</tr>
				<tr>
					<td><label>휴대폰</label></td>
					<td><input type="text" oninput="inputNumberOnly(this)" class="enter" name="m_tel" id="m_tel" 
					maxlength="11"  placeholder="숫자만 입력해주세요." required autocomplete="off"/></td>
				</tr>
				<tr>
					<td><label>주소</label></td>
					<td><input type="text" class="enter" id="sample4_roadAddress" 
						name="m_roadAddress" placeholder="도로명주소" readonly autocomplete="off"></td>
					<td><input type="button" class="certi"
						onclick="sample4_execDaumPostcode()" value="주소찾기"></td>
				</tr>
				<tr>
					<td><label></label></td>
					<td><input type="text" class="add_enter" id="sample4_postcode"
						placeholder="우편번호" readonly autocomplete="off"> <input type="text" class="add_enter"
						id="sample4_jibunAddress" placeholder="지번주소" readonly autocomplete="off"></td>
				</tr>
				<tr>
					<td><label></label></td>
					<td><input type="text" class="add_enter" 
						id="sample4_detailAddress" placeholder="상세주소"
						name="m_detailAddress" autocomplete="off"> <input type="text"
						class="add_enter" id="sample4_extraAddress" placeholder="참고항목" readonly autocomplete="off"></td>
				</tr>
			</table>
		</div>
		<br> <br>
		<hr>
		<br>
		<div class="select-wrapper">
			<table class="select">
				<tr>
					<td><label class="tema" id="tema">테마</label></td>
					<td><button type="button" class="btn1" name="tema" value="1">#등산</button>
						<button type="button" class="btn1" name="tema" value="2" >#바다</button>
						<button type="button" class="btn1" name="tema" value="3">#도시</button>
						<button type="button" class="btn1" name="tema" value="4">#계곡</button></td>
				</tr>
				<tr>
					<td><label></label></td>
					<td><button type="button" class="btn1" name="tema" value="5">#레저</button>
						<button type="button" class="btn1" name="tema" value="6">#문화</button>
						<button type="button" class="btn1" name="tema" value="7">#맛집</button>
						<button type="button" class="btn1" name="tema" value="8">#파티</button></td>
				</tr>
				<tr>
					<td><label class="tema" id="area">선호지역</label></td>
					<td><button type="button" class="btn2" name="area" value="1">#서울</button>
						<button type="button" class="btn2" name="area" value="2">#경기</button>
						<button type="button" class="btn2" name="area" value="3">#인천</button>
						<button type="button" class="btn2" name="area" value="4">#충청</button></td>
				</tr>
				<tr>
					<td><label></label></td>
					<td><button type="button" class="btn2" name="area" value="5">#강원</button>
						<button type="button" class="btn2" name="area" value="6">#경상</button>
						<button type="button" class="btn2" name="area" value="7">#전라</button>
						<button type="button" class="btn2" name="area" value="8">#제주</button></td>
				</tr>
				<tr>
					<td><label></label></td>
				</tr>


				<tr>
					<td colspan="2"><span class="tema_area">※ 테마 및 선호지역은 각각
							<b>최대 3개</b>까지 선택하실 수 있습니다.
					</span></td>
				</tr>

			</table>
		</div>

		<br>
		<hr>
		<br>

		<table class="agree">

			<tr>
				<td id="agree_label"><label>이용약관동의</label></td>
				<td>
					<div class="terms__check__all">
						<input type="checkbox" name="checkAll" id="checkAll" class="chk"/>
						<label for="checkAll" class="required" id="label_font">모두
							동의합니다.</label>
					</div>
				</td>
			</tr>
			<tr>
				<td></td>
				<td>
					<ul class="terms__list">
						<li class="terms__box">
							<div class="input__check">
								<input type="checkbox" name="agreement" id="termsOfService"
									class="chk"  required /> <label for="termsOfService" 
									class="required" id="label_font">이용약관 동의 <strong>(필수)</strong></label>
							</div>
						</li>
				</td>
				<td>
					<button type="button" id="btn-modal1">약관 보기 >></button>
					<div id="modal1" class="modal-overlay">
						<div class="modal-window">
							<div class="title">
								<div class="close-area">X</div>
								<p class="modal_title">이용약관 동의</p>
							</div>
							<div class="content">
								<p class="modal_content">
									동의? <br> 할거지? <br> 안할거야? <br> 왜? <br> 왜
									안하는거야? <br> 집착해도 될까? <br> 동의할 때까지 물어봐도 될까? <br>
									안하면 회원가입 못하는데? <br> 회원탈퇴는 안할거지? <br> 뭘 고민하는거야? <br>
									아직도 동의안해? <br> 아직도? <br> 이제 하지? <br>
								</p>
							</div>
							<div class="check_container">
								<button type="button" class="last_check">확인</button>
							</div>
						</div>
					</div>
				</td>
			</tr>
			<tr>
				<td></td>
				<td>
					<li class="terms__box">
						<div class="input__check">
							<input type="checkbox" name="agreement" id="privacyPolicy" 
								class="chk" required /> <label for="privacyPolicy"
								class="required" id="label_font">개인정보 수집 및 이용에 대한 안내 <strong>(필수)</strong></label>
						</div>
				</li>
				</td>
				<td>
					<button type="button" id="btn-modal2">약관 보기 >></button>
					<div id="modal2" class="modal-overlay">
						<div class="modal-window">
							<div class="title">
								<div class="close-area">X</div>
								<p class="modal_title">개인정보 수집 및 이용에 대한 안내</p>
							</div>
							<div class="content">
								<p class="modal_content">동의?</p>
							</div>
							<div class="check_container">
								<button type="button" class="last_check">확인</button>
							</div>
						</div>
					</div>
				</td>
			</tr>
			<tr>
				<td></td>
				<td>
					<li class="terms__box">
						<div class="input__check">
							<input type="checkbox" name="m_marketing" id="allowPromotions"
								class="chk"/> <label for="allowPromotions"
								id="label_font">이벤트 정보 수신 동의 <b>(선택)</b>
							</label>
						</div>
				</li>
				</td>
				</ul>
			</tr>

		</table>
		<br />
		<hr />
		<br />
		<div class="join_cancel">
			<button type="submit" class="join_button" id="join_button" disabled>회원가입</button>
			<a href="${pageContext.request.contextPath }/main" id="cancel_button">취소</a>
		</div>
		<br />
		<br />
			
	</form>
</body>
</html>